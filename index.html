<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AFS Marketplace | Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        /* CORES PADRÃO DO PROJETO */
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #050505; /* Preto do fundo */
            color: white; 
            overflow-x: hidden; 
        }

        .glass { 
            background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
        }

        /* VERMELHO PADRÃO AFS */
        .btn-filtro.active { 
            background: #dc2626; 
            color: white; 
            border-color: #dc2626; 
        }

        .text-afs-red { color: #dc2626; }
        .bg-afs-red { background-color: #dc2626; }

        .hidden { display: none; }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.6s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* BOTÃO WHATSAPP FLUTUANTE */
        .btn-whatsapp {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background-color: #25d366; /* Verde WhatsApp */
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
            z-index: 99;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .btn-whatsapp:active { transform: scale(0.9); }
    </style>
</head>
<body class="pb-32">

    <a href="https://wa.me/258846261950?text=Saudações%20AFS%20MULTISERVICE,%20Vim%20do%20marketplace." target="_blank" class="btn-whatsapp">
        <i class="fa-brands fa-whatsapp"></i>
    </a>

    <header class="p-6 sticky top-0 z-50 glass rounded-b-[2.5rem]">
        <div class="flex items-center gap-4">
            <img id="logo-markt" src="logo.png" class="h-14 w-14 rounded-full border-2 border-red-600 bg-white object-contain p-1">
            <div>
                <h1 class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Bem-vindo (a)</h1>
                <p class="text-lg font-extrabold uppercase italic leading-tight">
                    <span class="text-red-600">AFS</span> MARKETPLACE
                </p>
            </div>
        </div>
    </header>

    <div class="px-6 mt-6 space-y-4">
        <div id="lista-seccoes" class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
            <button onclick="setSec('TODOS', this)" class="btn-filtro active flex-shrink-0 px-5 py-2 rounded-xl border border-white/10 text-[9px] font-black uppercase">TODOS</button>
        </div>

        <div id="lista-marcas" class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide"></div>

        <div class="glass flex items-center px-4 py-3 rounded-2xl border border-white/10">
            <i class="fa-solid fa-magnifying-glass text-gray-500 mr-3 text-sm"></i>
            <input type="text" id="input-busca" onkeyup="buscar()" placeholder="PESQUISAR PRODUTO..." class="bg-transparent w-full text-[10px] font-bold outline-none uppercase text-white">
        </div>
    </div>

    <div class="flex justify-center mt-4 px-6">
        <p id="txt-aviso" class="text-[9px] font-bold uppercase tracking-widest text-white italic bg-white/5 px-6 py-2 rounded-full border border-white/10 text-center w-full">Carregando...</p>
    </div>

    <section id="produtos-grid" class="p-6 grid grid-cols-2 gap-5"></section>

    <nav class="fixed bottom-8 left-6 right-6 h-16 glass rounded-[2rem] flex justify-around items-center px-4 shadow-2xl border border-white/10">
        <i onclick="location.reload()" class="fa-solid fa-house-chimney text-red-600 text-lg cursor-pointer"></i>
        <div class="relative cursor-pointer" onclick="abrirCarrinho()">
            <i class="fa-solid fa-cart-shopping text-gray-500 text-lg"></i>
            <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-[8px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
        </div>
        <i onclick="location.href='login.html'" class="fa-regular fa-user text-gray-500 text-lg cursor-pointer"></i>
    </nav>

    <div id="modal-carrinho" class="fixed inset-0 z-[100] glass flex items-end justify-center hidden">
        <div class="bg-[#0a0a0a] w-full max-h-[80vh] rounded-t-[3rem] p-8 overflow-y-auto border-t border-white/10">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-black uppercase italic">Carrinho</h2>
                <button onclick="document.getElementById('modal-carrinho').classList.add('hidden')"><i class="fa-solid fa-xmark text-gray-500"></i></button>
            </div>
            <div id="lista-carrinho" class="space-y-4 mb-8"></div>
            <button onclick="abrirCheckout()" class="w-full bg-red-600 p-5 rounded-2xl font-black text-[10px] uppercase">Finalizar Compra</button>
        </div>
    </div>

    <div id="modal-checkout" class="fixed inset-0 z-[110] glass flex items-center justify-center p-6 hidden">
        <div class="bg-black border border-white/10 w-full rounded-[2.5rem] p-8 space-y-4">
            <h2 class="text-xl font-black italic uppercase text-red-600 text-center">Entrega</h2>
            <input type="text" id="f-nome" placeholder="SEU NOME" class="w-full bg-white/5 p-4 rounded-xl text-[10px] font-bold outline-none text-white border border-white/5 uppercase">
            <input type="number" id="f-tel" placeholder="SEU NÚMERO" class="w-full bg-white/5 p-4 rounded-xl text-[10px] font-bold outline-none text-white border border-white/5">
            <input type="text" id="f-local" placeholder="LOCAL" class="w-full bg-white/5 p-4 rounded-xl text-[10px] font-bold outline-none text-white border border-white/5 uppercase">
            <button id="btn-finalizar" class="w-full bg-red-600 p-4 rounded-xl font-black text-xs uppercase">Confirmar Pedido</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBn8kvmsWdPTc_gSxz5_u-bs3NJrmzwmE0",
            authDomain: "afsmultiservices.firebaseapp.com",
            projectId: "afsmultiservices",
            storageBucket: "afsmultiservices.firebasestorage.app",
            messagingSenderId: "477881971322",
            appId: "1:477881971322:web:bd25dfe8a9058c708241c3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let secAtiva = "TODOS", marcaAtiva = "TODOS", carrinho = [];

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('active'); });
        });

        // Lógica de Secções e Marcas
        onSnapshot(collection(db, "seccoes"), (snap) => {
            const cont = document.getElementById('lista-seccoes');
            cont.innerHTML = `<button onclick="setSec('TODOS', this)" class="btn-filtro active flex-shrink-0 px-5 py-2 rounded-xl border border-white/10 text-[9px] font-black uppercase">TODOS</button>`;
            snap.forEach(d => {
                cont.innerHTML += `<button onclick="setSec('${d.data().nome}', this)" class="btn-filtro flex-shrink-0 px-5 py-2 rounded-xl border border-white/10 text-[9px] font-black uppercase">${d.data().nome}</button>`;
            });
        });

        window.setSec = (s, btn) => {
            secAtiva = s; marcaAtiva = "TODOS";
            document.querySelectorAll('#lista-seccoes .btn-filtro').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            carregarMarcas();
            carregarProdutos();
        };

        function carregarMarcas() {
            const cont = document.getElementById('lista-marcas');
            if(secAtiva === "TODOS") { cont.innerHTML = ""; return; }
            onSnapshot(collection(db, "produtos"), (snap) => {
                let marcas = new Set();
                snap.forEach(d => { if(d.data().seccao === secAtiva) marcas.add(d.data().categoria); });
                cont.innerHTML = ""; 
                marcas.forEach(m => {
                    cont.innerHTML += `<button onclick="setMarca('${m}', this)" class="btn-filtro flex-shrink-0 px-4 py-1.5 rounded-lg border border-white/5 text-[8px] font-black uppercase">${m}</button>`;
                });
            });
        }

        window.setMarca = (m, btn) => {
            marcaAtiva = m;
            document.querySelectorAll('#lista-marcas .btn-filtro').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            carregarProdutos();
        };

        function carregarProdutos() {
            const grid = document.getElementById('produtos-grid');
            onSnapshot(collection(db, "produtos"), (snap) => {
                grid.innerHTML = "";
                snap.forEach(d => {
                    const p = d.data();
                    if((secAtiva === "TODOS" || p.seccao === secAtiva) && (marcaAtiva === "TODOS" || p.categoria === marcaAtiva)) {
                        const card = document.createElement('div');
                        card.className = "bg-[#0f0f0f] border border-white/5 rounded-[2rem] p-4 reveal product-card";
                        card.innerHTML = `
                            <img src="${p.foto}" class="h-32 w-full object-cover rounded-[1.5rem] mb-3">
                            <h3 class="text-[10px] font-black uppercase leading-tight">${p.nome}</h3>
                            <div class="mt-3 flex justify-between items-center">
                                <p class="text-red-600 font-black text-[10px] italic">${p.preco} MT</p>
                                <button onclick="addCart('${p.nome}', '${p.preco}', '${p.foto}')" class="w-7 h-7 bg-red-600 rounded-lg flex items-center justify-center"><i class="fa-solid fa-plus text-white text-[9px]"></i></button>
                            </div>`;
                        grid.appendChild(card);
                        observer.observe(card);
                    }
                });
            });
        }

        window.addCart = (nome, preco, foto) => {
            carrinho.push({nome, preco, foto});
            document.getElementById('cart-count').innerText = carrinho.length;
        };

        window.abrirCarrinho = () => {
            if(carrinho.length === 0) return alert("Carrinho vazio!");
            const list = document.getElementById('lista-carrinho');
            list.innerHTML = "";
            carrinho.forEach(item => {
                list.innerHTML += `<div class="bg-white/5 p-3 rounded-xl flex items-center gap-3 border border-white/5"><img src="${item.foto}" class="w-10 h-10 rounded object-cover"><p class="text-[9px] font-bold uppercase">${item.nome}</p></div>`;
            });
            document.getElementById('modal-carrinho').classList.remove('hidden');
        };

        window.abrirCheckout = () => {
            document.getElementById('modal-carrinho').classList.add('hidden');
            document.getElementById('modal-checkout').classList.remove('hidden');
        };

        document.getElementById('btn-finalizar').onclick = async () => {
            const ped = { cliente: document.getElementById('f-nome').value.toUpperCase(), tel: document.getElementById('f-tel').value, local: document.getElementById('f-local').value.toUpperCase(), itens: carrinho.map(c => c.nome).join(", "), data: new Date().toLocaleString() };
            if(!ped.cliente || !ped.tel) return alert("Preencha os dados!");
            await addDoc(collection(db, "pedidos"), ped);
            alert("PEDIDO ENVIADO!");
            location.reload();
        };

        onSnapshot(doc(db, "config", "main"), (d) => {
            if(d.exists()) {
                if(d.data().aviso) document.getElementById('txt-aviso').innerText = d.data().aviso;
                if(d.data().logo) document.getElementById('logo-markt').src = d.data().logo;
            }
        });

        window.buscar = () => {
            let b = document.getElementById('input-busca').value.toUpperCase();
            document.querySelectorAll('.product-card').forEach(c => {
                c.style.display = c.innerText.toUpperCase().includes(b) ? "" : "none";
            });
        };

        carregarProdutos();
    </script>
</body>
</html>
